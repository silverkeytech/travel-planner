@page
@model TravelPlanner.Pages.User.Reservation.ProgramListModel
@{
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="~/css/User/program.css" asp-append-version="true" />
    <div class="flex-container" style="display: flex; justify-content: space-between; align-items: center;">
        <h2>Choose Your Programs</h2>
        <div class="search-bar">
            <i class="fas fa-search search-icon"></i>
            <input type="text" placeholder="Search for program...">
        </div>
    </div>
    <div class="row">
        @foreach (var program in Model.ProgramList)
        {
            <div class="col-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-4 d-flex justify-content-center">
                                <img src="@program.profile_picture_path" alt="program image" class="img-fluid rounded" id="program-image">
                            </div>
                            <div class="col-sm-8">
                                <h4 class="card-title">@program.Name</h4>
                                <div class="card border-dark mb-3">
                                    <div class="card-body text-dark">
                                        <p class="card-text">@program.Description</p>
                                    </div>
                                </div>
                                <form method="post" asp-page-handler="Details">
                                    <input type="hidden" name="programId" value="@program.Id" />
                                    <button class="btn btn-primary details-button" type="submit">Show Prices and Details</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div> 
    <div id="popup" class="popup">
      <div class="popup-content">
        <span class="close" onclick="closePopup()">&times;</span>
        <h3 class="card-title">@Model.ProgramDetails.Name</h3>
        <div class="row">
            <div class="col-md-6">
                <h4 class="card-title">Program Highlights</h4>
                <ul>
                    @foreach (var highlight in Model.ProgramDetails.ProgramHighlights)
                    {
                        <li>@highlight</li>
                    }
                </ul>
            </div>
            <div class="col-md-6">
                <div class="card fit-card h-100">
                    <div class="card-body">
                        <div id="carouselImages" class="carousel slide" data-ride="carousel">
                            <div class="carousel-inner">
                                @for (var i = 0; i < Model.ProgramDetails.ImagesPath.Count; i++)
                                {
                                    <div class="carousel-item @if (i == 0) { <text>active</text> }">
                                        <img class="d-block" src="@Model.ProgramDetails.ImagesPath[i]" alt="Slide @(i + 1)">
                                    </div>
                                }
                            </div>
                            <a class="carousel-control-prev" href="#carouselImages" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next" href="#carouselImages" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>    
        <h3 class="card-title mt-3 mb-3">Available Activities</h3>
        <ul>
            @for (var i = 0; i < Model.ProgramDetails.Activities.Count; i++)
            {
                var activity = Model.ProgramDetails.Activities[i];
                var duration = activity.TimeToSpend;
                var price = activity.Price;
                var checkboxId = $"activity{i}";
                <li>
                    <div>
                        <label for="@checkboxId"><b>@activity.Name:</b></label>
                        <input type="checkbox" id="@checkboxId" name="activities" value="@activity.Name">
                    </div>
                    <ul>
                        @foreach (var detail in activity.Details)
                        {
                            <li>@detail</li>
                        }
                        <li>Duration: @duration</li>
                    </ul>
                    <p><b>Price:</b> $@price per person</p>
                </li>
            }
        </ul>
        <div class="buttons-container">
            <button class="btn btn-primary confirm-button" onclick="closePopup()"><span>&#10003;</span> Confirm</button>
            <button class="btn btn-secondary cancel-button" onclick="closePopup()"><span>&times;</span> Cancel</button>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script>
        function openPopup() {
          document.getElementById('popup').style.display = 'block';
        }
        function closePopup() {
          document.getElementById('popup').style.display = 'none';
        }
        $(document).ready(function () {
            $('#carouselImages').carousel();
    
            $('#carouselImages').carousel({
                interval: 2000
            });
    
            // Pause on hover
            $('#carouselImages').hover(function () {
                $(this).carousel('pause');
            }, function () {
                $(this).carousel('cycle');
            });

            $('.carousel-control-prev').click(function () {
                const targetCarouselId = $(this).attr('href');
                $(targetCarouselId).carousel('prev');
            });
    
            $('.carousel-control-next').click(function () {
                const targetCarouselId = $(this).attr('href');
                $(targetCarouselId).carousel('next');
            });
        });
        document.querySelectorAll('.carousel-control-prev, .carousel-control-next').forEach(function(link) {
            link.addEventListener('click', function(event) {
                event.preventDefault();
            });
        });
    </script>
}